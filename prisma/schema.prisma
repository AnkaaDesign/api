generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Activity {
  id          String            @id @default(uuid())
  quantity    Float
  operation   ActivityOperation @default(OUTBOUND)
  userId      String?
  itemId      String
  orderId     String?
  orderItemId String?
  reason      ActivityReason    @default(PRODUCTION_USAGE)
  reasonOrder Int?              @default(2)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  item        Item              @relation("ACTIVITY_ITEM", fields: [itemId], references: [id], onDelete: Cascade)
  order       Order?            @relation("ACTIVITY_ORDER", fields: [orderId], references: [id], onDelete: Cascade)
  orderItem   OrderItem?        @relation("ACTIVITY_ORDER_ITEM", fields: [orderItemId], references: [id], onDelete: Cascade)
  user        User?             @relation("ACTIVITY_USER", fields: [userId], references: [id], onDelete: Cascade)

  @@index([itemId])
  @@index([userId])
  @@index([orderId])
  @@index([orderItemId])
  @@index([createdAt])
  @@index([reasonOrder])
}

model Airbrushing {
  id                    String            @id @default(uuid())
  startDate             DateTime?
  finishDate            DateTime?
  price                 Float?
  status                AirbrushingStatus @default(PENDING)
  statusOrder           Int               @default(1)
  taskId                String
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  task                  Task              @relation("AIRBRUSHING", fields: [taskId], references: [id], onDelete: Cascade)
  artworks              File[]            @relation("AIRBRUSHING_ARTWORKS")
  budgets               File[]            @relation("AIRBRUSHING_BUDGETS")
  invoices              File[]            @relation("AIRBRUSHING_INVOICES")
  invoiceReimbursements File[]            @relation("AIRBRUSHING_INVOICE_REIMBURSEMENTS")
  receipts              File[]            @relation("AIRBRUSHING_RECEIPTS")
  reimbursements        File[]            @relation("AIRBRUSHING_REIMBURSEMENTS")

  @@index([statusOrder])
}

model Borrow {
  id          String       @id @default(uuid())
  itemId      String
  userId      String
  quantity    Float        @default(1)
  status      BorrowStatus @default(ACTIVE)
  statusOrder Int          @default(1)
  returnedAt  DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  item        Item         @relation(fields: [itemId], references: [id], onDelete: Cascade)
  user        User         @relation("USER_BORROW", fields: [userId], references: [id], onDelete: Cascade)

  @@index([itemId])
  @@index([userId])
  @@index([status, statusOrder])
}

model ChangeLog {
  id            String                    @id @default(uuid())
  entityType    ChangeLogEntityType
  entityId      String
  action        ChangeLogAction
  field         String?
  oldValue      Json?
  newValue      Json?
  reason        String?
  metadata      Json?
  userId        String?
  triggeredBy   ChangeLogTriggeredByType?
  triggeredById String?
  createdAt     DateTime                  @default(now())
  user          User?                     @relation("CHANGELOG_USER", fields: [userId], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([createdAt])
  @@index([userId])
}

model Bonus {
  id                 String          @id @default(uuid())
  userId             String
  baseBonus          Decimal         @default(0) @db.Decimal(10, 2)
  netBonus           Decimal         @default(0) @db.Decimal(10, 2)
  weightedTasks      Decimal         @default(0) @db.Decimal(10, 2)
  averageTaskPerUser Decimal         @default(0) @db.Decimal(10, 2)
  year               Int
  month              Int
  performanceLevel   Int
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  payrollId          String?         @unique
  payroll            Payroll?        @relation(fields: [payrollId], references: [id])
  user               User            @relation("UserBonus", fields: [userId], references: [id], onDelete: Cascade)
  bonusDiscounts     BonusDiscount[]
  users              User[]          @relation("BonusPeriodUsers")
  tasks              Task[]          @relation("BonusTasks")

  @@unique([userId, year, month])
  @@index([userId])
  @@index([year, month])
  @@index([weightedTasks])
  @@index([averageTaskPerUser])
  @@index([netBonus])
}

model Payroll {
  id                      String            @id @default(uuid())
  baseRemuneration        Decimal           @db.Decimal(10, 2)
  year                    Int
  month                   Int
  userId                  String
  positionId              String?
  workingDaysInMonth      Int?
  workedDaysInMonth       Int?
  absenceHours            Decimal           @default(0) @db.Decimal(10, 2)
  // Earnings breakdown
  overtime50Hours         Decimal?          @db.Decimal(10, 2)
  overtime50Amount        Decimal?          @db.Decimal(10, 2)
  overtime100Hours        Decimal?          @db.Decimal(10, 2)
  overtime100Amount       Decimal?          @db.Decimal(10, 2)
  nightHours              Decimal?          @db.Decimal(10, 2)
  nightDifferentialAmount Decimal?          @db.Decimal(10, 2)
  dsrAmount               Decimal?          @db.Decimal(10, 2)
  dsrDays                 Int?
  // Totals
  grossSalary             Decimal?          @db.Decimal(10, 2)
  inssBase                Decimal?          @db.Decimal(10, 2)
  inssAmount              Decimal?          @db.Decimal(10, 2)
  irrfBase                Decimal?          @db.Decimal(10, 2)
  irrfAmount              Decimal?          @db.Decimal(10, 2)
  fgtsAmount              Decimal?          @db.Decimal(10, 2)
  netSalary               Decimal?          @db.Decimal(10, 2)
  totalDiscounts          Decimal?          @db.Decimal(10, 2)
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt
  bonus                   Bonus?
  position                Position?         @relation(fields: [positionId], references: [id], onDelete: SetNull)
  user                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  discounts               PayrollDiscount[]

  @@unique([userId, year, month])
  @@index([userId])
  @@index([year, month])
  @@index([positionId])
}

model BonusDiscount {
  id               String   @id @default(uuid())
  bonusId          String
  percentage       Decimal? @db.Decimal(5, 2)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  calculationOrder Int      @default(1)
  reference        String
  value            Decimal? @db.Decimal(10, 2)
  bonus            Bonus    @relation(fields: [bonusId], references: [id], onDelete: Cascade)
  suspendedTasks   Task[]

  @@index([bonusId])
  @@index([calculationOrder])
}

model PayrollDiscount {
  id             String              @id @default(uuid())
  percentage     Decimal?            @db.Decimal(5, 2)
  value          Decimal?            @db.Decimal(10, 2)
  reference      String
  discountType   PayrollDiscountType @default(CUSTOM)
  isPersistent   Boolean             @default(false)
  isActive       Boolean             @default(true)
  taxYear        Int?
  taxTableId     String?
  taxTable       TaxTable?           @relation(fields: [taxTableId], references: [id], onDelete: SetNull)
  expirationDate DateTime?
  baseValue      Decimal?            @db.Decimal(10, 2)
  payrollId      String
  payroll        Payroll             @relation(fields: [payrollId], references: [id], onDelete: Cascade)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  @@index([payrollId])
  @@index([discountType])
  @@index([isPersistent])
  @@index([isActive])
  @@index([taxYear])
}

model TaxTable {
  id                String               @id @default(uuid())
  taxType           TaxType
  year              Int
  effectiveFrom     DateTime
  effectiveTo       DateTime?
  calculationMethod TaxCalculationMethod @default(PROGRESSIVE)
  description       String?              @db.Text
  legalReference    String?
  isActive          Boolean              @default(true)
  settings          Json?
  brackets          TaxBracket[]
  discounts         PayrollDiscount[]
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  @@unique([taxType, year, isActive])
  @@index([taxType, year])
  @@index([isActive])
  @@index([effectiveFrom])
}

model TaxBracket {
  id           String   @id @default(uuid())
  taxTableId   String
  taxTable     TaxTable @relation(fields: [taxTableId], references: [id], onDelete: Cascade)
  bracketOrder Int
  minValue     Decimal  @db.Decimal(10, 2)
  maxValue     Decimal? @db.Decimal(10, 2)
  rate         Decimal  @db.Decimal(5, 2)
  deduction    Decimal? @db.Decimal(10, 2)
  description  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([taxTableId, bracketOrder])
  @@index([taxTableId])
  @@index([bracketOrder])
}

model EconomicActivity {
  id          String     @id @default(uuid())
  code        String     @unique
  description String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  customers   Customer[]

  @@index([code])
  @@index([description])
}

model Customer {
  id                 String              @id @default(uuid())
  fantasyName        String              @unique
  cnpj               String?             @unique
  cpf                String?             @unique
  corporateName      String?
  email              String?
  address            String?
  addressNumber      String?
  addressComplement  String?
  neighborhood       String?
  city               String?
  state              String?
  zipCode            String?
  site               String?
  phones             String[]
  tags               String[]
  logoId             String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  economicActivityId String?
  registrationStatus RegistrationStatus?
  streetType         StreetType?
  economicActivity   EconomicActivity?   @relation(fields: [economicActivityId], references: [id], onDelete: SetNull)
  logo               File?               @relation("CUSTOMER_LOGO", fields: [logoId], references: [id], onDelete: SetNull)
  tasks              Task[]              @relation("TaskCustomer")
  invoiceTasks       Task[]              @relation("TaskInvoiceTo")

  @@index([fantasyName])
  @@index([cpf])
  @@index([neighborhood])
  @@index([zipCode])
  @@index([economicActivityId])
}

model PpeSize {
  id        String         @id @default(uuid())
  shirts    ShirtSize?
  boots     BootSize?
  pants     PantsSize?
  sleeves   SleevesSize?
  mask      MaskSize?
  gloves    GlovesSize?
  rainBoots RainBootsSize?
  userId    String         @unique
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  user      User           @relation("USER_PPE_SIZE", fields: [userId], references: [id], onDelete: Cascade)
}

model PpeDelivery {
  id                 String               @id @default(uuid())
  userId             String
  itemId             String
  status             PpeDeliveryStatus    @default(PENDING)
  statusOrder        Int                  @default(1)
  quantity           Int
  reason             String?
  reviewedBy         String?
  ppeScheduleId      String?
  scheduledDate      DateTime?
  actualDeliveryDate DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  item               Item                 @relation("PPE_DELIVERY_ITEM", fields: [itemId], references: [id], onDelete: Cascade)
  ppeSchedule        PpeDeliverySchedule? @relation("PPE_DELIVERY_SCHEDULE", fields: [ppeScheduleId], references: [id], onDelete: Cascade)
  reviewedByUser     User?                @relation("PPE_DELIVERY_REVIEWED_BY", fields: [reviewedBy], references: [id], onDelete: SetNull)
  user               User                 @relation("PPE_DELIVERY_USER", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([itemId])
  @@index([ppeScheduleId])
  @@index([scheduledDate])
  @@index([status, statusOrder])
  @@index([reviewedBy])
}

model PpeDeliverySchedule {
  id              String                 @id @default(uuid())
  assignmentType  AssignmentType         @default(ALL)
  excludedUserIds String[]               @default([])
  includedUserIds String[]               @default([])
  frequency       ScheduleFrequency
  frequencyCount  Int                    @default(1)
  isActive        Boolean                @default(true)
  ppeItems        Json
  specificDate    DateTime?
  dayOfMonth      Int?
  dayOfWeek       DayOfWeek?
  month           Month?
  customMonths    Month[]
  weeklyConfigId  String?                @unique
  monthlyConfigId String?                @unique
  yearlyConfigId  String?                @unique
  nextRun         DateTime?
  lastRun         DateTime?
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  autoOrders      Order[]                @relation("PPE_AUTO_ORDER")
  deliveries      PpeDelivery[]          @relation("PPE_DELIVERY_SCHEDULE")
  monthlyConfig   MonthlyScheduleConfig? @relation(fields: [monthlyConfigId], references: [id])
  weeklyConfig    WeeklyScheduleConfig?  @relation(fields: [weeklyConfigId], references: [id])
  yearlyConfig    YearlyScheduleConfig?  @relation(fields: [yearlyConfigId], references: [id])

  @@index([nextRun])
  @@index([isActive])
  @@index([assignmentType])
}

model File {
  id                                      String               @id @default(uuid())
  filename                                String
  originalName                            String
  mimetype                                String
  path                                    String
  size                                    Int
  thumbnailUrl                            String?
  createdAt                               DateTime             @default(now())
  updatedAt                               DateTime             @updatedAt
  customerLogo                            Customer[]           @relation("CUSTOMER_LOGO")
  taskCuts                                Cut[]                @relation("TASK_CUTS")
  layoutPhotos                            Layout[]             @relation("LAYOUT_PHOTO")
  supplierLogo                            Supplier[]           @relation("SUPPLIER_LOGO")
  userAvatar                              User[]               @relation("USER_AVATAR")
  thumbnailJob                            ThumbnailJob?
  airbrushingArtworks                     Airbrushing[]        @relation("AIRBRUSHING_ARTWORKS")
  airbrushingBudgets                      Airbrushing[]        @relation("AIRBRUSHING_BUDGETS")
  airbrushingInvoices                     Airbrushing[]        @relation("AIRBRUSHING_INVOICES")
  airbrushingInvoiceReimbursements        Airbrushing[]        @relation("AIRBRUSHING_INVOICE_REIMBURSEMENTS")
  airbrushingReceipts                     Airbrushing[]        @relation("AIRBRUSHING_RECEIPTS")
  airbrushingReimbursements               Airbrushing[]        @relation("AIRBRUSHING_REIMBURSEMENTS")
  externalWithdrawalInvoices              ExternalWithdrawal[] @relation("EXTERNAL_WITHDRAWAL_INVOICES")
  externalWithdrawalInvoiceReimbursements ExternalWithdrawal[] @relation("EXTERNAL_WITHDRAWAL_INVOICE_REIMBURSEMENTS")
  externalWithdrawalReceipts              ExternalWithdrawal[] @relation("EXTERNAL_WITHDRAWAL_RECEIPTS")
  externalWithdrawalReimbursements        ExternalWithdrawal[] @relation("EXTERNAL_WITHDRAWAL_REIMBURSEMENTS")
  warning                                 Warning[]            @relation("FileToWarning")
  observations                            Observation[]        @relation("OBSERVATIONS_FILES")
  orderBudgets                            Order[]              @relation("ORDER_BUDGETS")
  orderInvoices                           Order[]              @relation("ORDER_INVOICES")
  orderInvoiceReimbursements              Order[]              @relation("ORDER_INVOICE_REIMBURSEMENTS")
  orderReceipts                           Order[]              @relation("ORDER_RECEIPTS")
  orderReimbursements                     Order[]              @relation("ORDER_REIMBURSEMENTS")
  taskBudgets                             Task[]               @relation("TASK_BUDGETS")
  tasksArtworks                           Task[]               @relation("TASK_FILES")
  taskInvoices                            Task[]               @relation("TASK_INVOICES")
  taskInvoiceReimbursements               Task[]               @relation("TASK_INVOICE_REIMBURSEMENTS")
  taskReceipts                            Task[]               @relation("TASK_RECEIPTS")
  taskReimbursements                      Task[]               @relation("TASK_REIMBURSEMENTS")
  taskBaseFiles                           Task[]               @relation("TASK_BASE_FILES")

  @@index([filename])
  @@index([originalName])
  @@index([mimetype])
  @@index([path])
}

model MonetaryValue {
  id         String    @id @default(uuid())
  value      Float
  current    Boolean   @default(false)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  itemId     String?
  positionId String?
  item       Item?     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  position   Position? @relation(fields: [positionId], references: [id], onDelete: Cascade)

  @@index([current])
  @@index([itemId])
  @@index([positionId])
  @@index([itemId, current])
  @@index([positionId, current])
}

model Measure {
  id          String       @id @default(uuid())
  value       Float?
  unit        MeasureUnit?
  measureType MeasureType
  itemId      String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  item        Item         @relation("ITEM_MEASURES", fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId])
  @@index([measureType])
}

model Item {
  id                             String                   @id @default(uuid())
  name                           String
  uniCode                        String?
  quantity                       Float                    @default(0)
  maxQuantity                    Float?
  reorderPoint                   Float?
  reorderQuantity                Float?
  boxQuantity                    Int?
  totalPrice                     Float?
  monthlyConsumption             Decimal                  @default(0) @db.Decimal(10, 2)
  monthlyConsumptionTrendPercent Decimal?                 @db.Decimal(5, 2)
  barcodes                       String[]                 @default([])
  shouldAssignToUser             Boolean                  @default(true)
  abcCategory                    AbcCategory?
  abcCategoryOrder               Int?
  xyzCategory                    XyzCategory?
  xyzCategoryOrder               Int?
  brandId                        String?
  categoryId                     String?
  supplierId                     String?
  estimatedLeadTime              Int?                     @default(30)
  isActive                       Boolean                  @default(true)
  ppeType                        PpeType?
  ppeCA                          String?
  ppeDeliveryMode                PpeDeliveryMode?
  ppeStandardQuantity            Int?
  createdAt                      DateTime                 @default(now())
  updatedAt                      DateTime                 @updatedAt
  icms                           Float                    @default(0)
  ipi                            Float                    @default(0)
  activities                     Activity[]               @relation("ACTIVITY_ITEM")
  borrows                        Borrow[]
  externalWithdrawalItems        ExternalWithdrawalItem[]
  brand                          ItemBrand?               @relation("ITEM_BRAND", fields: [brandId], references: [id])
  category                       ItemCategory?            @relation("ITEM_CATEGORY", fields: [categoryId], references: [id])
  supplier                       Supplier?                @relation("ITEM_SUPPLIER", fields: [supplierId], references: [id])
  maintenance                    Maintenance[]            @relation("MAINTENANCE_ITEM")
  maintenanceItemsNeeded         MaintenanceItem[]        @relation("MAINTENANCE_ITEM_NEEDED")
  maintenanceSchedules           MaintenanceSchedule[]    @relation("MAINTENANCE_SCHEDULE_ITEM")
  measures                       Measure[]                @relation("ITEM_MEASURES")
  prices                         MonetaryValue[]
  orderItems                     OrderItem[]              @relation("ORDER_ITEM_ITEM")
  orderRules                     OrderRule[]
  formulaComponents              PaintFormulaComponent[]
  ppeDelivery                    PpeDelivery[]            @relation("PPE_DELIVERY_ITEM")
  paintBrands                    PaintBrand[]             @relation("PAINT_BRAND_COMPONENT_ITEMS")
  paintTypes                     PaintType[]              @relation("PAINT_TYPE_COMPONENT_ITEMS")
  relatedItems                   Item[]                   @relation("RelatedItems")
  relatedTo                      Item[]                   @relation("RelatedItems")

  @@index([shouldAssignToUser])
  @@index([categoryId, brandId])
  @@index([name])
  @@index([isActive])
  @@index([supplierId])
  @@index([abcCategory, abcCategoryOrder])
  @@index([xyzCategory, xyzCategoryOrder])
  @@index([ppeType])
  @@index([categoryId, ppeType])
}

model WeeklyScheduleConfig {
  id                  String               @id @default(uuid())
  monday              Boolean              @default(false)
  tuesday             Boolean              @default(false)
  wednesday           Boolean              @default(false)
  thursday            Boolean              @default(false)
  friday              Boolean              @default(false)
  saturday            Boolean              @default(false)
  sunday              Boolean              @default(false)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  maintenanceSchedule MaintenanceSchedule?
  orderSchedule       OrderSchedule?
  ppeSchedule         PpeDeliverySchedule?
}

model MonthlyScheduleConfig {
  id                  String               @id @default(uuid())
  dayOfMonth          Int?
  occurrence          MonthOccurrence?
  dayOfWeek           DayOfWeek?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  maintenanceSchedule MaintenanceSchedule?
  orderSchedule       OrderSchedule?
  ppeSchedule         PpeDeliverySchedule?
}

model YearlyScheduleConfig {
  id                  String               @id @default(uuid())
  month               Month
  dayOfMonth          Int?
  occurrence          MonthOccurrence?
  dayOfWeek           DayOfWeek?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  maintenanceSchedule MaintenanceSchedule?
  orderSchedule       OrderSchedule?
  ppeSchedule         PpeDeliverySchedule?
}

model OrderRule {
  id               String           @id @default(uuid())
  itemId           String
  supplierId       String?
  isActive         Boolean          @default(true)
  priority         Int              @default(0)
  triggerType      OrderTriggerType
  consumptionDays  Int?
  safetyStockDays  Int?
  minOrderQuantity Float?
  maxOrderQuantity Float?
  orderMultiple    Float?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  item             Item             @relation(fields: [itemId], references: [id], onDelete: Cascade)
  supplier         Supplier?        @relation(fields: [supplierId], references: [id])

  @@index([itemId])
  @@index([supplierId])
  @@index([isActive])
}

model ItemBrand {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  items     Item[]   @relation("ITEM_BRAND")
}

model ItemCategory {
  id        String           @id @default(uuid())
  name      String           @unique
  type      ItemCategoryType @default(REGULAR)
  typeOrder Int              @default(1)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  items     Item[]           @relation("ITEM_CATEGORY")

  @@index([type, typeOrder])
}

model Observation {
  id          String   @id @default(uuid())
  description String
  taskId      String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  task        Task     @relation("OBSERVATION_TO_TASK", fields: [taskId], references: [id], onDelete: Cascade)
  files       File[]   @relation("OBSERVATIONS_FILES")

  @@index([taskId])
  @@index([createdAt])
}

model ExternalWithdrawal {
  id                    String                   @id @default(uuid())
  withdrawerName        String
  type                  ExternalWithdrawalType   @default(RETURNABLE)
  status                ExternalWithdrawalStatus @default(PENDING)
  statusOrder           Int                      @default(1)
  notes                 String?
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  items                 ExternalWithdrawalItem[]
  invoices              File[]                   @relation("EXTERNAL_WITHDRAWAL_INVOICES")
  invoiceReimbursements File[]                   @relation("EXTERNAL_WITHDRAWAL_INVOICE_REIMBURSEMENTS")
  receipts              File[]                   @relation("EXTERNAL_WITHDRAWAL_RECEIPTS")
  reimbursements        File[]                   @relation("EXTERNAL_WITHDRAWAL_REIMBURSEMENTS")

  @@index([withdrawerName])
  @@index([type])
  @@index([status, statusOrder])
  @@index([createdAt])
}

model ExternalWithdrawalItem {
  id                   String             @id @default(uuid())
  externalWithdrawalId String
  itemId               String
  withdrawedQuantity   Float
  returnedQuantity     Float              @default(0)
  price                Float?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  externalWithdrawal   ExternalWithdrawal @relation(fields: [externalWithdrawalId], references: [id], onDelete: Cascade)
  item                 Item               @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([externalWithdrawalId])
  @@index([itemId])
}

model Maintenance {
  id                    String               @id @default(uuid())
  name                  String
  description           String?
  status                MaintenanceStatus    @default(PENDING)
  statusOrder           Int                  @default(1)
  itemId                String
  maintenanceScheduleId String?
  scheduledFor          DateTime?
  startedAt             DateTime?
  finishedAt            DateTime?
  timeTaken             Int?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  item                  Item                 @relation("MAINTENANCE_ITEM", fields: [itemId], references: [id], onDelete: Cascade)
  maintenanceSchedule   MaintenanceSchedule? @relation("MAINTENANCE_FROM_SCHEDULE", fields: [maintenanceScheduleId], references: [id])
  itemsNeeded           MaintenanceItem[]

  @@index([itemId])
  @@index([status])
  @@index([statusOrder])
  @@index([maintenanceScheduleId])
  @@index([scheduledFor])
}

model MaintenanceItem {
  id            String      @id @default(uuid())
  maintenanceId String
  itemId        String
  quantity      Float       @default(1)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  item          Item        @relation("MAINTENANCE_ITEM_NEEDED", fields: [itemId], references: [id], onDelete: Cascade)
  maintenance   Maintenance @relation(fields: [maintenanceId], references: [id], onDelete: Cascade)

  @@index([maintenanceId])
  @@index([itemId])
}

model MaintenanceSchedule {
  id                     String                    @id @default(uuid())
  name                   String
  description            String?
  itemId                 String?
  frequency              ScheduleFrequency
  frequencyCount         Int                       @default(1)
  isActive               Boolean                   @default(true)
  status                 MaintenanceScheduleStatus @default(PENDING)
  statusOrder            Int                       @default(1)
  maintenanceItemsConfig Json?
  specificDate           DateTime?
  dayOfMonth             Int?
  dayOfWeek              DayOfWeek?
  month                  Month?
  customMonths           Month[]
  weeklyConfigId         String?                   @unique
  monthlyConfigId        String?                   @unique
  yearlyConfigId         String?                   @unique
  nextRun                DateTime?
  lastRun                DateTime?
  createdAt              DateTime                  @default(now())
  updatedAt              DateTime                  @updatedAt
  finishedAt             DateTime?
  lastRunId              String?
  originalScheduleId     String?
  maintenances           Maintenance[]             @relation("MAINTENANCE_FROM_SCHEDULE")
  item                   Item?                     @relation("MAINTENANCE_SCHEDULE_ITEM", fields: [itemId], references: [id])
  monthlyConfig          MonthlyScheduleConfig?    @relation(fields: [monthlyConfigId], references: [id])
  weeklyConfig           WeeklyScheduleConfig?     @relation(fields: [weeklyConfigId], references: [id])
  yearlyConfig           YearlyScheduleConfig?     @relation(fields: [yearlyConfigId], references: [id])

  @@index([itemId])
  @@index([nextRun])
  @@index([status, statusOrder])
  @@index([lastRunId])
  @@index([originalScheduleId])
}

model Order {
  id                    String               @id @default(uuid())
  description           String
  forecast              DateTime?
  status                OrderStatus          @default(CREATED)
  statusOrder           Int                  @default(1)
  supplierId            String?
  orderScheduleId       String?              @unique
  orderRuleId           String?
  ppeScheduleId         String?
  notes                 String?
  paymentMethod         PaymentMethod?
  paymentPix            String?
  paymentDueDays        Int?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  activities            Activity[]           @relation("ACTIVITY_ORDER")
  orderSchedule         OrderSchedule?       @relation("ORDER_TO_SCHEDULE", fields: [orderScheduleId], references: [id])
  ppeSchedule           PpeDeliverySchedule? @relation("PPE_AUTO_ORDER", fields: [ppeScheduleId], references: [id])
  supplier              Supplier?            @relation("ORDER_SUPPLIER", fields: [supplierId], references: [id])
  items                 OrderItem[]
  budgets               File[]               @relation("ORDER_BUDGETS")
  invoices              File[]               @relation("ORDER_INVOICES")
  invoiceReimbursements File[]               @relation("ORDER_INVOICE_REIMBURSEMENTS")
  receipts              File[]               @relation("ORDER_RECEIPTS")
  reimbursements        File[]               @relation("ORDER_REIMBURSEMENTS")

  @@index([status])
  @@index([statusOrder])
  @@index([supplierId])
  @@index([createdAt])
  @@index([ppeScheduleId])
}

model OrderItem {
  id                       String     @id @default(uuid())
  orderId                  String
  itemId                   String?
  orderedQuantity          Float
  receivedQuantity         Float      @default(0)
  price                    Float
  receivedAt               DateTime?
  fulfilledAt              DateTime?
  createdAt                DateTime   @default(now())
  updatedAt                DateTime   @updatedAt
  temporaryItemDescription String?
  icms                     Float      @default(0)
  ipi                      Float      @default(0)
  activities               Activity[] @relation("ACTIVITY_ORDER_ITEM")
  item                     Item?      @relation("ORDER_ITEM_ITEM", fields: [itemId], references: [id], onDelete: Cascade)
  order                    Order      @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([itemId])
}

model OrderSchedule {
  id                 String                 @id @default(uuid())
  frequency          ScheduleFrequency
  frequencyCount     Int                    @default(1)
  isActive           Boolean                @default(true)
  items              String[]
  specificDate       DateTime?
  dayOfMonth         Int?
  dayOfWeek          DayOfWeek?
  month              Month?
  customMonths       Month[]
  weeklyConfigId     String?                @unique
  monthlyConfigId    String?                @unique
  yearlyConfigId     String?                @unique
  nextRun            DateTime?
  lastRun            DateTime?
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  finishedAt         DateTime?
  lastRunId          String?
  originalScheduleId String?
  order              Order?                 @relation("ORDER_TO_SCHEDULE")
  monthlyConfig      MonthlyScheduleConfig? @relation(fields: [monthlyConfigId], references: [id])
  weeklyConfig       WeeklyScheduleConfig?  @relation(fields: [weeklyConfigId], references: [id])
  yearlyConfig       YearlyScheduleConfig?  @relation(fields: [yearlyConfigId], references: [id])

  @@index([nextRun])
  @@index([lastRunId])
  @@index([originalScheduleId])
}

model PaintProduction {
  id           String       @id @default(uuid())
  volumeLiters Float
  formulaId    String
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  formula      PaintFormula @relation(fields: [formulaId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([formulaId])
}

model Paint {
  id               String             @id @default(uuid())
  name             String
  hex              String
  finish           PaintFinish
  manufacturer     TruckManufacturer?
  tags             String[]
  paintTypeId      String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  code             String?
  paintBrandId     String?
  colorOrder       Int                @default(0)
  colorPreview     String? // Paint preview image URL (WebP)
  paintBrand       PaintBrand?        @relation(fields: [paintBrandId], references: [id])
  paintType        PaintType          @relation(fields: [paintTypeId], references: [id], onDelete: Cascade)
  formulas         PaintFormula[]
  groundPaintFor   PaintGround[]      @relation("GROUND_PAINT_FOR")
  paintGrounds     PaintGround[]      @relation("PAINT_REQUIRES_GROUND")
  generalPaintings Task[]             @relation("TASK_GENERAL_PAINTING")
  relatedPaints    Paint[]            @relation("RelatedPaints")
  relatedTo        Paint[]            @relation("RelatedPaints")
  logoTasks        Task[]             @relation("TASK_LOGO_PAINT")

  @@index([name])
  @@index([paintTypeId])
  @@index([paintBrandId])
  @@index([paintTypeId, paintBrandId])
  @@index([colorOrder])
}

model PaintBrand {
  id             String   @id @default(uuid())
  name           String   @unique
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  paints         Paint[]
  componentItems Item[]   @relation("PAINT_BRAND_COMPONENT_ITEMS")

  @@index([name])
}

model PaintType {
  id             String   @id @default(uuid())
  name           String   @unique
  needGround     Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  paints         Paint[]
  componentItems Item[]   @relation("PAINT_TYPE_COMPONENT_ITEMS")

  @@index([name])
}

model PaintGround {
  id            String   @id @default(uuid())
  paintId       String
  groundPaintId String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  groundPaint   Paint    @relation("GROUND_PAINT_FOR", fields: [groundPaintId], references: [id], onDelete: Cascade)
  paint         Paint    @relation("PAINT_REQUIRES_GROUND", fields: [paintId], references: [id], onDelete: Cascade)

  @@unique([paintId, groundPaintId])
  @@index([paintId])
  @@index([groundPaintId])
}

model PaintFormula {
  id              String                  @id @default(uuid())
  description     String                  @default("Cor criada.")
  paintId         String
  density         Decimal                 @default(1.0)
  pricePerLiter   Decimal                 @default(0)
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  paint           Paint                   @relation(fields: [paintId], references: [id], onDelete: Cascade)
  components      PaintFormulaComponent[]
  paintProduction PaintProduction[]

  @@index([paintId])
}

model PaintFormulaComponent {
  id             String       @id @default(uuid())
  ratio          Float
  itemId         String
  formulaPaintId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  weight         Float?
  formula        PaintFormula @relation(fields: [formulaPaintId], references: [id], onDelete: Cascade)
  item           Item         @relation(fields: [itemId], references: [id])

  @@index([itemId])
  @@index([formulaPaintId])
}

model Position {
  id            String          @id @default(uuid())
  name          String          @unique
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  bonifiable    Boolean         @default(true)
  hierarchy     Int?
  remunerations MonetaryValue[]
  payrolls      Payroll[]
  users         User[]          @relation("USER_POSITION")

  @@index([name])
  @@index([hierarchy])
}

model Warning {
  id             String          @id @default(uuid())
  description    String?
  collaboratorId String
  supervisorId   String
  category       WarningCategory
  severity       WarningSeverity
  severityOrder  Int             @default(1)
  reason         String
  isActive       Boolean         @default(true)
  hrNotes        String?
  followUpDate   DateTime
  resolvedAt     DateTime?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  collaborator   User            @relation("COLLABORATOR_WARNING", fields: [collaboratorId], references: [id])
  supervisor     User            @relation("SUPERVISOR_WARNING", fields: [supervisorId], references: [id])
  attachments    File[]          @relation("FileToWarning")
  witness        User[]          @relation("WITNESS_WARNING")

  @@index([collaboratorId])
  @@index([severityOrder])
}

model Sector {
  id         String           @id @default(uuid())
  name       String
  privileges SectorPrivileges @default(BASIC)
  managerId  String?          @unique
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  tasks      Task[]
  manager    User?            @relation("SECTOR_MANAGER", fields: [managerId], references: [id])
  users      User[]

  @@index([managerId])
}

model Service {
  id          String           @id @default(uuid())
  description String
  type        ServiceOrderType @default(PRODUCTION)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@unique([description, type])
  @@index([type])
}

model ServiceOrder {
  id           String             @id @default(uuid())
  status       ServiceOrderStatus @default(PENDING)
  statusOrder  Int                @default(1)
  description  String
  type         ServiceOrderType   @default(PRODUCTION)
  assignedToId String?
  taskId       String
  createdById  String
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  startedAt    DateTime?
  finishedAt   DateTime?
  assignedTo   User?              @relation("SERVICE_ORDER_ASSIGNED_TO", fields: [assignedToId], references: [id], onDelete: SetNull)
  task         Task               @relation("SERVICE_ORDER_TASK", fields: [taskId], references: [id], onDelete: Cascade)
  createdBy    User               @relation("SERVICE_ORDER_CREATED_BY", fields: [createdById], references: [id])

  @@index([taskId])
  @@index([statusOrder])
  @@index([type])
  @@index([assignedToId])
  @@index([createdById])
}

model TaskPricing {
  id        String            @id @default(uuid())
  total     Decimal           @db.Decimal(10, 2)
  expiresAt DateTime
  status    TaskPricingStatus @default(DRAFT)
  taskId    String            @unique
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  task      Task              @relation("TASK_PRICING", fields: [taskId], references: [id], onDelete: Cascade)
  items     TaskPricingItem[] @relation("PRICING_ITEMS")

  @@index([taskId])
  @@index([status])
  @@index([expiresAt])
}

model TaskPricingItem {
  id          String      @id @default(uuid())
  description String      @db.Text
  amount      Decimal     @db.Decimal(10, 2)
  pricingId   String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  pricing     TaskPricing @relation("PRICING_ITEMS", fields: [pricingId], references: [id], onDelete: Cascade)

  @@index([pricingId])
}

model Supplier {
  id                String      @id @default(uuid())
  fantasyName       String      @unique
  cnpj              String?     @unique
  corporateName     String?
  email             String?
  address           String?
  addressNumber     String?
  addressComplement String?
  neighborhood      String?
  city              String?
  state             String?
  zipCode           String?
  site              String?
  phones            String[]
  pix               String?
  logoId            String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  streetType        StreetType?
  tags              String[]    @default([])
  items             Item[]      @relation("ITEM_SUPPLIER")
  orders            Order[]     @relation("ORDER_SUPPLIER")
  orderRules        OrderRule[]
  logo              File?       @relation("SUPPLIER_LOGO", fields: [logoId], references: [id], onDelete: SetNull)

  @@index([fantasyName])
  @@index([cnpj])
  @@index([state])
  @@index([city])
}

model Task {
  id                    String               @id @default(uuid())
  name                  String?              @default("Tarefa Sem Nome")
  status                TaskStatus           @default(PREPARATION)
  statusOrder           Int                  @default(1)
  serialNumber          String?              @unique
  details               String?
  entryDate             DateTime?
  term                  DateTime?
  startedAt             DateTime?
  finishedAt            DateTime?
  forecastDate          DateTime? // Forecast date when truck will be available from customer
  paintId               String?
  customerId            String?
  invoiceToId           String? // Customer to invoice (can be different from customerId)
  sectorId              String?
  commission            CommissionStatus?
  negotiatingWith       Json? // Contact person negotiating the task: { name: string, phone: string }
  createdById           String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  bonusDiscountId       String?
  airbrushings          Airbrushing[]        @relation("AIRBRUSHING")
  pricing               TaskPricing?         @relation("TASK_PRICING")
  cuts                  Cut[]                @relation("CUT_TASK")
  observation           Observation?         @relation("OBSERVATION_TO_TASK")
  serviceOrders         ServiceOrder[]       @relation("SERVICE_ORDER_TASK")
  bonusDiscount         BonusDiscount?       @relation(fields: [bonusDiscountId], references: [id])
  createdBy             User?                @relation("TASK_CREATED_BY", fields: [createdById], references: [id])
  customer              Customer?            @relation("TaskCustomer", fields: [customerId], references: [id])
  invoiceTo             Customer?            @relation("TaskInvoiceTo", fields: [invoiceToId], references: [id])
  generalPainting       Paint?               @relation("TASK_GENERAL_PAINTING", fields: [paintId], references: [id])
  sector                Sector?              @relation(fields: [sectorId], references: [id])
  truck                 Truck?
  bonuses               Bonus[]              @relation("BonusTasks")
  relatedTasks          Task[]               @relation("RelatedTasks")
  relatedTo             Task[]               @relation("RelatedTasks")
  budgets               File[]               @relation("TASK_BUDGETS")
  artworks              File[]               @relation("TASK_FILES")
  invoices              File[]               @relation("TASK_INVOICES")
  invoiceReimbursements File[]               @relation("TASK_INVOICE_REIMBURSEMENTS")
  logoPaints            Paint[]              @relation("TASK_LOGO_PAINT")
  receipts              File[]               @relation("TASK_RECEIPTS")
  reimbursements        File[]               @relation("TASK_REIMBURSEMENTS")
  baseFiles             File[]               @relation("TASK_BASE_FILES")
  fieldChangeLogs       TaskFieldChangeLog[] @relation("TASK_FIELD_CHANGE_LOGS")

  @@index([status, sectorId])
  @@index([statusOrder])
  @@index([term])
  @@index([forecastDate])
  @@index([createdAt])
  @@index([customerId])
  @@index([invoiceToId])
  @@index([createdById])
}

model TaskFieldChangeLog {
  id           String   @id @default(uuid())
  taskId       String
  field        String // Field name (e.g., 'status', 'term', 'artworks')
  oldValue     Json? // Previous value
  newValue     Json? // New value
  changedBy    String // User ID who made the change
  changedAt    DateTime @default(now())
  isFileArray  Boolean  @default(false) // Whether this is a file array field
  filesAdded   Int      @default(0) // Number of files added (for file arrays)
  filesRemoved Int      @default(0) // Number of files removed (for file arrays)
  metadata     Json? // Additional context (e.g., file details)
  task         Task     @relation("TASK_FIELD_CHANGE_LOGS", fields: [taskId], references: [id], onDelete: Cascade)
  user         User     @relation("TASK_FIELD_CHANGE_USER", fields: [changedBy], references: [id])

  @@index([taskId])
  @@index([field])
  @@index([changedAt])
  @@index([changedBy])
  @@index([taskId, field])
}

model Cut {
  id          String            @id @default(uuid())
  fileId      String
  type        CutType
  taskId      String?
  origin      CutOrigin         @default(PLAN)
  reason      CutRequestReason?
  parentCutId String?
  status      CutStatus         @default(PENDING)
  statusOrder Int               @default(1)
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  file        File              @relation("TASK_CUTS", fields: [fileId], references: [id])
  parentCut   Cut?              @relation("CUT_PARENT", fields: [parentCutId], references: [id])
  childCuts   Cut[]             @relation("CUT_PARENT")
  task        Task?             @relation("CUT_TASK", fields: [taskId], references: [id])

  @@index([status])
  @@index([statusOrder])
  @@index([taskId])
  @@index([parentCutId])
  @@index([origin])
}

model Truck {
  id                String         @id @default(uuid())
  plate             String?        @unique
  chassisNumber     String?
  category          TruckCategory? // Type of truck (mini, vuc, 3/4, toco, truck, semi-trailer, b-double)
  implementType     ImplementType? // Type of body/implement (corrugated, insulated, curtain-side, tank, flatbed)
  spot              TRUCK_SPOT? // Parking spot in garage (B1_F1_V1, B1_F2_V1, etc.) or PATIO
  taskId            String         @unique
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  backSideLayoutId  String?        @unique
  leftSideLayoutId  String?        @unique
  rightSideLayoutId String?        @unique
  backSideLayout    Layout?        @relation("TRUCK_BACK_SIDE", fields: [backSideLayoutId], references: [id])
  leftSideLayout    Layout?        @relation("TRUCK_LEFT_SIDE", fields: [leftSideLayoutId], references: [id])
  rightSideLayout   Layout?        @relation("TRUCK_RIGHT_SIDE", fields: [rightSideLayoutId], references: [id])
  task              Task           @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([spot])
  @@index([plate])
}

model Layout {
  id             String          @id @default(uuid())
  height         Float
  photoId        String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  photo          File?           @relation("LAYOUT_PHOTO", fields: [photoId], references: [id])
  layoutSections LayoutSection[] @relation("LayoutSections")
  truckBackSide  Truck?          @relation("TRUCK_BACK_SIDE")
  truckLeftSide  Truck?          @relation("TRUCK_LEFT_SIDE")
  truckRightSide Truck?          @relation("TRUCK_RIGHT_SIDE")
}

model LayoutSection {
  id         String   @id @default(uuid())
  layoutId   String
  width      Float
  isDoor     Boolean  @default(false)
  doorHeight Float? // Height of the door from bottom of layout to top of door opening (in meters)
  position   Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  layout     Layout   @relation("LayoutSections", fields: [layoutId], references: [id], onDelete: Cascade)

  @@index([layoutId, position])
}

// Garage model removed - garages are now static configuration
// See: api/src/constants/garage.ts and shared types for static garage definitions
// 3 Garages: B1 (20x30m), B2 (18.5x30.5m), B3 (20x40m)
// Each has 3 lanes (F1, F2, F3) with 3 spots (V1, V2, V3) each

model SecullumToken {
  id           String   @id @default(uuid())
  accessToken  String
  refreshToken String?
  tokenType    String   @default("Bearer")
  expiresIn    Int
  expiresAt    DateTime
  scope        String?
  identifier   String   @unique @default("default")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([expiresAt])
  @@index([identifier])
}

model User {
  id                      String                       @id @default(uuid())
  email                   String?                      @unique
  payrollNumber           Int?
  name                    String
  status                  UserStatus                   @default(EXPERIENCE_PERIOD_1)
  statusOrder             Int                          @default(1)
  phone                   String?                      @unique
  password                String?
  positionId              String?
  preferenceId            String?                      @unique
  pis                     String?                      @unique
  cpf                     String?                      @unique
  address                 String?
  addressNumber           String?
  addressComplement       String?
  neighborhood            String?
  city                    String?
  state                   String?
  zipCode                 String?
  site                    String?
  birth                   DateTime?
  verified                Boolean                      @default(false)
  admissional             DateTime?
  sectorId                String?
  requirePasswordChange   Boolean                      @default(false)
  lastLoginAt             DateTime?
  verificationCode        String?
  verificationExpiresAt   DateTime?
  verificationType        VerificationType?
  sessionToken            String?                      @unique
  createdAt               DateTime                     @default(now())
  updatedAt               DateTime                     @updatedAt
  performanceLevel        Int                          @default(0)
  effectedAt              DateTime?
  exp1StartAt             DateTime?
  exp1EndAt               DateTime?
  exp2StartAt             DateTime?
  exp2EndAt               DateTime?
  dismissedAt             DateTime?
  avatarId                String?
  isActive                Boolean                      @default(true)
  unionMember             Boolean                      @default(false)
  unionAuthorizationDate  DateTime?
  dependentsCount         Int                          @default(0)
  hasSimplifiedDeduction  Boolean                      @default(true)
  activities              Activity[]                   @relation("ACTIVITY_USER")
  bonuses                 Bonus[]                      @relation("UserBonus")
  borrows                 Borrow[]                     @relation("USER_BORROW")
  changeLogs              ChangeLog[]                  @relation("CHANGELOG_USER")
  taskFieldChangeLogs     TaskFieldChangeLog[]         @relation("TASK_FIELD_CHANGE_USER")
  notifications           Notification[]               @relation("NOTIFICATION_CREATED_BY")
  payrolls                Payroll[]
  ppeDeliveriesReviewed   PpeDelivery[]                @relation("PPE_DELIVERY_REVIEWED_BY")
  ppeDeliveries           PpeDelivery[]                @relation("PPE_DELIVERY_USER")
  ppeSize                 PpeSize?                     @relation("USER_PPE_SIZE")
  preference              Preferences?                 @relation("USER_PREFERENCES")
  seenNotification        SeenNotification[]
  createdTasks            Task[]                       @relation("TASK_CREATED_BY")
  avatar                  File?                        @relation("USER_AVATAR", fields: [avatarId], references: [id])
  managedSector           Sector?                      @relation("SECTOR_MANAGER")
  position                Position?                    @relation("USER_POSITION", fields: [positionId], references: [id])
  sector                  Sector?                      @relation(fields: [sectorId], references: [id])
  vacations               Vacation[]
  warningsCollaborator    Warning[]                    @relation("COLLABORATOR_WARNING")
  warningsSupervisor      Warning[]                    @relation("SUPERVISOR_WARNING")
  deployments             Deployment[]                 @relation("DEPLOYMENT_USER")
  bonusesInPeriod         Bonus[]                      @relation("BonusPeriodUsers")
  warningsWitness         Warning[]                    @relation("WITNESS_WARNING")
  assignedServiceOrders   ServiceOrder[]               @relation("SERVICE_ORDER_ASSIGNED_TO")
  createdServiceOrders    ServiceOrder[]               @relation("SERVICE_ORDER_CREATED_BY")
  notificationPreferences UserNotificationPreference[] @relation("USER_NOTIFICATION_PREFERENCES")
  deviceTokens            DeviceToken[]                @relation("USER_DEVICE_TOKENS")
  createdMessages         Message[]                    @relation("MESSAGE_CREATED_BY")
  messageTargets          MessageTarget[]              @relation("MESSAGE_TARGET_USER")
  messageViews            MessageView[]                @relation("MESSAGE_VIEW_USER")

  @@index([status, sectorId])
  @@index([statusOrder])
  @@index([isActive])
  @@index([exp1StartAt])
  @@index([exp1EndAt])
  @@index([exp2StartAt])
  @@index([exp2EndAt])
  @@index([effectedAt])
  @@index([dismissedAt])
  @@index([email])
  @@index([phone])
  @@index([email, phone])
  @@index([verificationCode])
  @@index([verificationExpiresAt])
  @@index([verificationType])
  @@index([sessionToken])
  @@index([verified])
  @@index([admissional])
}

model Vacation {
  id           String         @id @default(uuid())
  userId       String?
  startAt      DateTime
  endAt        DateTime
  isCollective Boolean        @default(false)
  status       VacationStatus @default(PENDING)
  statusOrder  Int            @default(1)
  type         VacationType   @default(COLLECTIVE)
  typeOrder    Int            @default(2)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  user         User?          @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([startAt, endAt])
  @@index([statusOrder])
}

model Preferences {
  id          String      @id @default(uuid())
  userId      String      @unique
  colorSchema ColorSchema @default(LIGHT)
  favorites   String[]    @default([])
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  user        User        @relation("USER_PREFERENCES", fields: [userId], references: [id], onDelete: Cascade)
}

model NotificationPreference {
  id               String                 @id @default(uuid())
  notificationType NotificationType
  enabled          Boolean
  channels         NotificationChannel[]
  importance       NotificationImportance
  fieldName        String?
  isMandatory      Boolean                @default(false)
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
}

model Notification {
  id                String                  @id @default(uuid())
  userId            String?
  title             String
  body              String
  type              NotificationType
  channel           NotificationChannel[]
  importance        NotificationImportance  @default(NORMAL)
  actionType        NotificationActionType?
  actionUrl         String?
  scheduledAt       DateTime?
  sentAt            DateTime?
  deliveredAt       DateTime?
  deliveredChannels NotificationChannel[]
  failedChannels    NotificationChannel[]
  retryCount        Int                     @default(0)
  metadata          Json?
  relatedEntityType String?
  relatedEntityId   String?
  targetSectors     SectorPrivileges[]
  isMandatory       Boolean                 @default(false)
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  user              User?                   @relation("NOTIFICATION_CREATED_BY", fields: [userId], references: [id])
  seenBy            SeenNotification[]
  deliveries        NotificationDelivery[]

  @@index([userId])
  @@index([scheduledAt])
}

model SeenNotification {
  id             String       @id @default(uuid())
  userId         String
  notificationId String
  seenAt         DateTime     @default(now())
  remindAt       DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, notificationId])
}

model DeviceToken {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  platform  Platform
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation("USER_DEVICE_TOKENS", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([platform])
}

model UserNotificationPreference {
  id                String                @id @default(uuid())
  userId            String
  notificationType  NotificationType
  eventType         String?
  enabled           Boolean               @default(true)
  channels          NotificationChannel[]
  isMandatory       Boolean               @default(false)
  mandatoryChannels NotificationChannel[] @default([])
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  user User @relation("USER_NOTIFICATION_PREFERENCES", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, notificationType, eventType])
  @@index([userId])
}

model NotificationDelivery {
  id             String              @id @default(uuid())
  notificationId String
  channel        NotificationChannel
  status         DeliveryStatus      @default(PENDING)
  sentAt         DateTime?
  deliveredAt    DateTime?
  failedAt       DateTime?
  errorMessage   String?
  metadata       Json?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  notification Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)

  @@index([notificationId])
  @@index([status])
}

model ThumbnailJob {
  id          String    @id @default(uuid())
  fileId      String    @unique @map("file_id")
  jobId       String?   @map("job_id")
  status      String
  error       String?
  progress    Int?      @default(0)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  completedAt DateTime? @map("completed_at")
  attempts    Int       @default(0)
  file        File      @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@map("thumbnail_jobs")
}

model Repository {
  id          String      @id @default(uuid())
  name        String      @unique
  gitUrl      String      @map("git_url")
  branch      String      @default("main")
  isActive    Boolean     @default(true) @map("is_active")
  description String?
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  apps        App[]
  commits     GitCommit[]

  @@map("repositories")
}

model GitCommit {
  id           String       @id @default(uuid())
  repositoryId String       @map("repository_id")
  hash         String
  shortHash    String       @map("short_hash")
  message      String
  author       String
  authorEmail  String       @map("author_email")
  committedAt  DateTime     @map("committed_at")
  branch       String
  tags         String[]     @default([])
  filesChanged Int          @default(0) @map("files_changed")
  insertions   Int          @default(0)
  deletions    Int          @default(0)
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  deployments  Deployment[]
  repository   Repository   @relation(fields: [repositoryId], references: [id], onDelete: Cascade)

  @@unique([repositoryId, hash])
  @@index([repositoryId])
  @@index([committedAt])
  @@index([branch])
  @@map("git_commits")
}

model App {
  id              String       @id @default(uuid())
  repositoryId    String       @map("repository_id")
  name            String       @unique
  displayName     String       @map("display_name")
  appType         AppType      @map("app_type")
  buildCommand    String?      @map("build_command")
  deployCommand   String?      @map("deploy_command")
  healthCheckUrl  String?      @map("health_check_url")
  environmentVars Json?        @map("environment_vars")
  isActive        Boolean      @default(true) @map("is_active")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  repository      Repository   @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  deployments     Deployment[]

  @@index([repositoryId])
  @@index([appType])
  @@map("apps")
}

model Deployment {
  id                   String                @id @default(uuid())
  environment          DeploymentEnvironment
  status               DeploymentStatus      @default(PENDING)
  statusOrder          Int                   @default(2) @map("status_order")
  deployedBy           String?               @map("deployed_by")
  version              String?
  rollbackData         Json?                 @map("rollback_data")
  deploymentLog        String?               @map("deployment_log")
  healthCheckUrl       String?               @map("health_check_url")
  healthCheckStatus    String?               @map("health_check_status")
  completedAt          DateTime?             @map("completed_at")
  rolledBackAt         DateTime?             @map("rolled_back_at")
  createdAt            DateTime              @default(now()) @map("created_at")
  updatedAt            DateTime              @updatedAt @map("updated_at")
  appId                String                @map("app_id")
  gitCommitId          String                @map("git_commit_id")
  triggeredBy          DeploymentTrigger     @default(MANUAL) @map("triggered_by")
  buildNumber          Int?                  @map("build_number")
  previousDeploymentId String?               @unique @map("previous_deployment_id")
  workflowRunId        String?               @map("workflow_run_id")
  workflowUrl          String?               @map("workflow_url")
  duration             Int?
  buildLog             String?               @map("build_log")
  errorMessage         String?               @map("error_message")
  errorStack           String?               @map("error_stack")
  healthCheckLog       String?               @map("health_check_log")
  canRollback          Boolean               @default(true) @map("can_rollback")
  rollbackReason       String?               @map("rollback_reason")
  startedAt            DateTime?             @map("started_at")
  logs                 DeploymentLog[]
  metrics              DeploymentMetric[]
  app                  App                   @relation(fields: [appId], references: [id], onDelete: Cascade)
  user                 User?                 @relation("DEPLOYMENT_USER", fields: [deployedBy], references: [id])
  gitCommit            GitCommit             @relation(fields: [gitCommitId], references: [id])
  previousDeployment   Deployment?           @relation("DeploymentRollback", fields: [previousDeploymentId], references: [id])
  rollbackedDeployment Deployment?           @relation("DeploymentRollback")

  @@index([appId, environment, status])
  @@index([gitCommitId])
  @@index([appId, environment])
  @@index([createdAt])
  @@index([statusOrder])
  @@index([triggeredBy])
  @@map("deployments")
}

model DeploymentLog {
  id           String             @id @default(uuid())
  deploymentId String             @map("deployment_id")
  level        DeploymentLogLevel
  phase        DeploymentPhase
  message      String
  details      Json?
  stackTrace   String?            @map("stack_trace")
  source       String?
  duration     Int?
  createdAt    DateTime           @default(now()) @map("created_at")
  deployment   Deployment         @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  @@index([deploymentId])
  @@index([deploymentId, phase])
  @@index([level])
  @@index([createdAt])
  @@map("deployment_logs")
}

model DeploymentMetric {
  id           String     @id @default(uuid())
  deploymentId String     @map("deployment_id")
  metricType   String     @map("metric_type")
  value        Float
  unit         String
  createdAt    DateTime   @default(now()) @map("created_at")
  deployment   Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  @@index([deploymentId])
  @@index([metricType])
  @@map("deployment_metrics")
}

enum UserStatus {
  EXPERIENCE_PERIOD_1
  EXPERIENCE_PERIOD_2
  EFFECTED
  DISMISSED
}

enum CutType {
  VINYL
  STENCIL
}

enum CutRequestReason {
  WRONG_APPLY
  LOST
  WRONG
}

enum CutOrigin {
  PLAN
  REQUEST
}

enum PpeType {
  SHIRT
  PANTS
  BOOTS
  SLEEVES
  MASK
  GLOVES
  RAIN_BOOTS
  OTHERS
}

enum PpeDeliveryMode {
  SCHEDULED
  ON_DEMAND
  BOTH
}

enum ShirtSize {
  P
  M
  G
  GG
  XG
}

enum PantsSize {
  SIZE_36
  SIZE_38
  SIZE_40
  SIZE_42
  SIZE_44
  SIZE_46
  SIZE_48
}

enum BootSize {
  SIZE_36
  SIZE_38
  SIZE_40
  SIZE_42
  SIZE_44
  SIZE_46
  SIZE_48
  SIZE_35
  SIZE_37
  SIZE_39
  SIZE_41
  SIZE_43
  SIZE_45
  SIZE_47
}

enum SleevesSize {
  P
  M
  G
  GG
  XG
}

enum MaskSize {
  P
  M
}

enum GlovesSize {
  P
  M
  G
}

enum RainBootsSize {
  SIZE_36
  SIZE_38
  SIZE_40
  SIZE_42
  SIZE_44
  SIZE_46
  SIZE_35
  SIZE_37
  SIZE_39
  SIZE_41
  SIZE_43
  SIZE_45
  SIZE_47
  SIZE_48
}

enum PpeSizeEnum {
  P
  M
  G
  GG
  XG
  SIZE_36
  SIZE_38
  SIZE_40
  SIZE_42
  SIZE_44
  SIZE_46
  SIZE_48
  SIZE_35
  SIZE_37
  SIZE_39
  SIZE_41
  SIZE_43
  SIZE_45
  SIZE_47
}

enum PpeDeliveryStatus {
  PENDING
  APPROVED
  DELIVERED
  REPROVED
  CANCELLED
}

enum ActivityReason {
  ORDER_RECEIVED
  PRODUCTION_USAGE
  PPE_DELIVERY
  BORROW
  RETURN
  EXTERNAL_WITHDRAWAL
  EXTERNAL_WITHDRAWAL_RETURN
  INVENTORY_COUNT
  MANUAL_ADJUSTMENT
  MAINTENANCE
  DAMAGE
  LOSS
  PAINT_PRODUCTION
  OTHER
}

enum OrderStatus {
  CREATED
  PARTIALLY_FULFILLED
  FULFILLED
  OVERDUE
  PARTIALLY_RECEIVED
  RECEIVED
  CANCELLED
}

enum PaymentMethod {
  PIX
  BANK_SLIP
  CREDIT_CARD
}

enum MaintenanceScheduleStatus {
  PENDING
  FINISHED
  CANCELLED
}

enum TaskStatus {
  PREPARATION
  WAITING_PRODUCTION
  IN_PRODUCTION
  COMPLETED
  CANCELLED
}

enum ServiceOrderType {
  PRODUCTION
  FINANCIAL
  NEGOTIATION
  ARTWORK
}

enum ServiceOrderStatus {
  PENDING
  IN_PROGRESS
  WAITING_APPROVE
  COMPLETED
  CANCELLED
}

enum AirbrushingStatus {
  PENDING
  IN_PRODUCTION
  COMPLETED
  CANCELLED
}

enum CutStatus {
  PENDING
  CUTTING
  COMPLETED
}

enum MaintenanceStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  OVERDUE
}

enum AbsenceStatus {
  PENDING_JUSTIFICATION
  JUSTIFICATION_SUBMITTED
  APPROVED
  REJECTED
}

enum VacationStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  IN_PROGRESS
  COMPLETED
}

enum PpeRequestStatus {
  PENDING
  APPROVED
  REJECTED
  DELIVERED
  CANCELLED
}

enum BorrowStatus {
  ACTIVE
  RETURNED
  LOST
  OVERDUE
}

enum ExternalWithdrawalType {
  RETURNABLE
  CHARGEABLE
  COMPLIMENTARY
}

enum ExternalWithdrawalStatus {
  // Common statuses
  PENDING
  CANCELLED
  // Returnable specific
  PARTIALLY_RETURNED
  FULLY_RETURNED
  // Chargeable specific
  CHARGED
  LIQUIDATED
  // Complimentary specific
  DELIVERED
}

enum VacationType {
  ANNUAL
  COLLECTIVE
  MEDICAL
  MATERNITY
  PATERNITY
  EMERGENCY
  STUDY
  UNPAID
  OTHER
}

enum PaintFinish {
  SOLID
  METALLIC
  PEARL
  MATTE
  SATIN
}

enum TruckManufacturer {
  SCANIA
  VOLVO
  DAF
  VOLKSWAGEN
  IVECO
  MERCEDES_BENZ
}

enum WarningSeverity {
  VERBAL
  WRITTEN
  SUSPENSION
  FINAL_WARNING
}

enum WarningCategory {
  SAFETY
  MISCONDUCT
  INSUBORDINATION
  POLICY_VIOLATION
  ATTENDANCE
  PERFORMANCE
  BEHAVIOR
  OTHER
}

enum NotificationType {
  SYSTEM
  TASK
  ORDER
  SERVICE_ORDER
  PPE
  VACATION
  WARNING
  STOCK
  GENERAL
  TASK_STATUS
  TASK_DEADLINE
  TASK_ASSIGNMENT
  TASK_FIELD_UPDATE
  ORDER_CREATED
  ORDER_STATUS
  ORDER_OVERDUE
  STOCK_LOW
  STOCK_OUT
  STOCK_REORDER
}

enum NotificationImportance {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum NotificationChannel {
  EMAIL
  SMS
  PUSH
  IN_APP
  WHATSAPP
  DESKTOP_PUSH
  MOBILE_PUSH
}

enum Platform {
  IOS
  ANDROID
  WEB
}

enum DeliveryStatus {
  PENDING
  PROCESSING
  DELIVERED
  FAILED
  RETRYING
}

enum ColorSchema {
  LIGHT
  DARK
  SYSTEM
}

enum VerificationType {
  EMAIL
  PHONE
  PASSWORD_RESET
}

enum MeasureUnit {
  KILOGRAM
  GRAM
  MILLILITER
  LITER
  CUBIC_METER
  CUBIC_CENTIMETER
  MILLIMETER
  CENTIMETER
  METER
  INCHES
  INCH_1_8
  INCH_1_4
  INCH_3_8
  INCH_1_2
  INCH_5_8
  INCH_3_4
  INCH_7_8
  INCH_1
  INCH_1_1_4
  INCH_1_1_2
  INCH_2
  THREAD_MM
  THREAD_TPI
  WATT
  VOLT
  AMPERE
  SQUARE_CENTIMETER
  SQUARE_METER
  UNIT
  PAIR
  DOZEN
  HUNDRED
  THOUSAND
  PACKAGE
  BOX
  ROLL
  SHEET
  SET
  SACK
  P
  M
  G
  GG
  XG
}

enum MeasureType {
  WEIGHT
  VOLUME
  LENGTH
  WIDTH
  AREA
  COUNT
  DIAMETER
  THREAD
  ELECTRICAL
  SIZE
}

enum SectorPrivileges {
  BASIC
  PRODUCTION
  MAINTENANCE
  WAREHOUSE
  PLOTTING
  ADMIN
  HUMAN_RESOURCES
  EXTERNAL
  DESIGNER
  FINANCIAL
  LOGISTIC
  COMMERCIAL
}

enum ScheduleFrequency {
  ONCE
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  BIMONTHLY
  QUARTERLY
  TRIANNUAL
  QUADRIMESTRAL
  SEMI_ANNUAL
  ANNUAL
  CUSTOM
}

enum AssignmentType {
  ALL
  ALL_EXCEPT
  SPECIFIC
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum Month {
  JANUARY
  FEBRUARY
  MARCH
  APRIL
  MAY
  JUNE
  JULY
  AUGUST
  SEPTEMBER
  OCTOBER
  NOVEMBER
  DECEMBER
}

enum MonthOccurrence {
  FIRST
  SECOND
  THIRD
  FOURTH
  LAST
}

// Truck parking spots in garages
// Format: B{garage}_F{lane}_V{spot} where garage=1-3, lane=1-3, spot=1-3
// PATIO = trucks in the yard, not assigned to a garage spot yet
enum TRUCK_SPOT {
  // Garage 1 (B1)
  B1_F1_V1
  B1_F1_V2
  B1_F1_V3
  B1_F2_V1
  B1_F2_V2
  B1_F2_V3
  B1_F3_V1
  B1_F3_V2
  B1_F3_V3
  // Garage 2 (B2)
  B2_F1_V1
  B2_F1_V2
  B2_F1_V3
  B2_F2_V1
  B2_F2_V2
  B2_F2_V3
  B2_F3_V1
  B2_F3_V2
  B2_F3_V3
  // Garage 3 (B3)
  B3_F1_V1
  B3_F1_V2
  B3_F1_V3
  B3_F2_V1
  B3_F2_V2
  B3_F2_V3
  B3_F3_V1
  B3_F3_V2
  B3_F3_V3
  // Patio (outside, not in a garage)
  PATIO
}

// Truck categories/types
enum TruckCategory {
  MINI // Mini truck (small urban delivery)
  VUC // VUC - Veculo Urbano de Carga (Urban Cargo Vehicle)
  THREE_QUARTER // 3/4 truck (light commercial)
  RIGID // Toco - Rigid truck with single rear axle
  TRUCK // Standard truck
  SEMI_TRAILER // Carreta - Semi-trailer truck
  B_DOUBLE // Bitrem - B-Double (truck with double trailer)
}

// Truck body/implement types
enum ImplementType {
  CORRUGATED // Corrugado - Corrugated body
  INSULATED // Isoplastic - Insulated/refrigerated body
  CURTAIN_SIDE // Sider - Curtain-side body
  TANK // Tanque - Tank truck
  FLATBED // Carroceria - Open flatbed/stake body
}

enum OrderTriggerType {
  STOCK_LEVEL
  CONSUMPTION_RATE
  SCHEDULED
}

enum ChangeLogTriggeredByType {
  TASK_CREATE
  TASK_UPDATE
  ITEM_UPDATE
  USER_ACTION
  BATCH_CREATE
  BATCH_UPDATE
  BATCH_DELETE
  BATCH_OPERATION
  SYSTEM
  SYSTEM_GENERATED
  USER
  EXTERNAL_WITHDRAWAL
  EXTERNAL_WITHDRAWAL_DELETE
  EXTERNAL_WITHDRAWAL_RETURN
  EXTERNAL_WITHDRAWAL_SYNC
  EXTERNAL_WITHDRAWAL_ITEM
  EXTERNAL_WITHDRAWAL_ITEM_UPDATE
  EXTERNAL_WITHDRAWAL_ITEM_DELETE
  PAINT_FORMULA_COMPONENT_CREATE
  PAINT_FORMULA_COMPONENT_UPDATE
  PAINT_FORMULA_COMPONENT_DELETE
  PAINT_FORMULA_COMPONENT_BATCH_CREATE
  PAINT_FORMULA_COMPONENT_BATCH_UPDATE
  PAINT_FORMULA_COMPONENT_BATCH_DELETE
  PAINT_PRODUCTION_CREATE
  PAINT_PRODUCTION_UPDATE
  PAINT_PRODUCTION_DELETE
  PAINT_PRODUCTION_BATCH_CREATE
  PAINT_PRODUCTION_BATCH_UPDATE
  PAINT_PRODUCTION_BATCH_DELETE
  PAINT_CREATE
  PAINT_UPDATE
  PAINT_DELETE
  PAINT_BATCH_CREATE
  PAINT_BATCH_UPDATE
  PAINT_BATCH_DELETE
  PAINT_FORMULA_CREATE
  PAINT_FORMULA_UPDATE
  PAINT_FORMULA_DELETE
  PAINT_FORMULA_BATCH_CREATE
  PAINT_FORMULA_BATCH_UPDATE
  PAINT_FORMULA_BATCH_DELETE
  PAINT_TYPE_CREATE
  PAINT_TYPE_UPDATE
  PAINT_TYPE_DELETE
  PAINT_TYPE_BATCH_CREATE
  PAINT_TYPE_BATCH_UPDATE
  PAINT_TYPE_BATCH_DELETE
  PAINT_BRAND_CREATE
  PAINT_BRAND_UPDATE
  PAINT_BRAND_DELETE
  PAINT_BRAND_BATCH_CREATE
  PAINT_BRAND_BATCH_UPDATE
  PAINT_BRAND_BATCH_DELETE
  PAINT_GROUND_CREATE
  PAINT_GROUND_UPDATE
  PAINT_GROUND_DELETE
  PAINT_GROUND_BATCH_CREATE
  PAINT_GROUND_BATCH_UPDATE
  PAINT_GROUND_BATCH_DELETE
  ORDER_UPDATE
  ORDER_CREATE
  ORDER_STATUS_CHANGE
  ORDER_CANCEL
  ORDER_ITEM_UPDATE
  ORDER_ITEM_RECEIVED
  ORDER_ITEM_SYNC
  SCHEDULE
  ACTIVITY_CREATE
  ACTIVITY_UPDATE
  ACTIVITY_DELETE
  ACTIVITY_SYNC
  INVENTORY_ADJUSTMENT
  INVENTORY_COUNT
  ITEM_MONTHLY_CONSUMPTION_UPDATE
  AUTOMATIC_MIN_MAX_UPDATE
  PPE_DELIVERY
  SMS_VERIFICATION_CREATE
  SMS_VERIFICATION_SEND
  SMS_VERIFICATION_VERIFY
  SMS_VERIFICATION_EXPIRE
  SMS_VERIFICATION_CANCEL
  EMAIL_SERVICE
  VERIFICATION_CREATE
  VERIFICATION_SEND
  VERIFICATION_VERIFY
  VERIFICATION_EXPIRE
  VERIFICATION_CANCEL
  VERIFICATION_RESEND
  OBSERVATION_CREATE
  OBSERVATION_DELETE
  SCHEDULED_JOB
  API
  WEBHOOK
  ADMIN
}

enum ChangeLogEntityType {
  ABSENCE
  ACTIVITY
  AIRBRUSHING
  BONUS
  BORROW
  CALCULATION
  CALCULATION_DECOMPOSITION
  CALCULATION_DETAIL
  CATEGORY
  COLLECTION
  COMMISSION
  CUSTOMER
  CUT
  CUT_ITEM
  CUT_PLAN
  CUT_REQUEST
  DELIVERY
  DEPLOYMENT
  DISCOUNT
  ECONOMIC_ACTIVITY
  EXPENSE
  EXTERNAL_WITHDRAWAL
  EXTERNAL_WITHDRAWAL_ITEM
  FILE
  HOLIDAY
  ITEM
  ITEM_BRAND
  ITEM_CATEGORY
  LAYOUT
  MAINTENANCE
  MAINTENANCE_ITEM
  MAINTENANCE_SCHEDULE
  NOTIFICATION
  NOTIFICATION_PREFERENCE
  OBSERVATION
  ORDER
  ORDER_ITEM
  ORDER_RULE
  ORDER_SCHEDULE
  PAINT
  PAINT_FORMULA
  PAINT_FORMULA_COMPONENT
  PAINT_GROUND
  PAINT_PRODUCTION
  PAINT_TYPE
  PARKING_SPOT
  PAYROLL
  PIECE
  POSITION
  PPE_CONFIG
  PPE_DELIVERY
  PPE_DELIVERY_ITEM
  PPE_DELIVERY_SCHEDULE
  PPE_REQUEST
  PPE_SIZE
  PRICE
  PRODUCTION
  PURCHASE
  SECTOR
  SEEN_NOTIFICATION
  SERVICE
  SERVICE_ORDER
  SUPPLIER
  TASK
  TIME_CLOCK_ENTRY
  TRUCK
  USER
  VACATION
  VERIFICATION
  WARNING
}

enum ChangeLogAction {
  CREATE
  UPDATE
  DELETE
  RESTORE
  ARCHIVE
  UNARCHIVE
  ACTIVATE
  DEACTIVATE
  APPROVE
  REJECT
  CANCEL
  COMPLETE
  ROLLBACK
  RESCHEDULE
  BATCH_CREATE
  BATCH_UPDATE
  BATCH_DELETE
}

enum NotificationActionType {
  VIEW_DETAILS
  APPROVE_REQUEST
  REJECT_REQUEST
  COMPLETE_TASK
  TASK_CREATED
  TASK_UPDATED
  VIEW_ORDER
  VIEW_REPORT
  ACKNOWLEDGE
  DISMISS
}

enum ActivityOperation {
  INBOUND
  OUTBOUND
}

enum AbcCategory {
  A
  B
  C
}

enum XyzCategory {
  X
  Y
  Z
}

enum ItemCategoryType {
  REGULAR
  TOOL
  PPE
}

enum BonusStatus {
  DRAFT
  CONFIRMED
}

enum CommissionStatus {
  PARTIAL_COMMISSION
  NO_COMMISSION
  FULL_COMMISSION
  SUSPENDED_COMMISSION
}

enum TaskPricingStatus {
  DRAFT
  APPROVED
  REJECTED
  CANCELLED
}

enum PayrollDiscountType {
  // Tax deductions (auto-calculated)
  INSS
  IRRF
  FGTS
  // Absence-related deductions
  ABSENCE // DIAS FALTAS - Full day absences
  PARTIAL_ABSENCE // HORAS FALTAS PARCIAL - Partial hour absences
  DSR_ABSENCE // DIAS FALTAS DSR - DSR deduction for absences
  LATE_ARRIVAL // Atrasos - Late arrivals
  SICK_LEAVE // DIAS AFAST. P/DOENCA - Sick leave (may be paid)
  // Legal/Court-ordered deductions
  UNION // CONTRIBUICAO NEGOCIAL - Union contribution
  ALIMONY // PENSAO ALIMENTICIA - Child support/alimony
  GARNISHMENT // Court-ordered garnishments
  // Benefits deductions
  HEALTH_INSURANCE
  DENTAL_INSURANCE
  MEAL_VOUCHER
  TRANSPORT_VOUCHER
  // Financial deductions
  LOAN // DESC. EMP. CRED. TRAB - Employee loans
  ADVANCE // DESC.ADIANT.SALARIAL - Salary advances
  AUTHORIZED_DISCOUNT // DESCONTOS AUTORIZADOS - Other authorized discounts
  // Generic
  CUSTOM
}

enum TaxType {
  INSS
  IRRF
}

enum TaxCalculationMethod {
  PROGRESSIVE
  FIXED
  ABSOLUTE
}

enum DeploymentEnvironment {
  STAGING
  PRODUCTION
  DEVELOPMENT
}

enum DeploymentStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  ROLLED_BACK
  BUILDING
  TESTING
  DEPLOYING
  CANCELLED
}

enum AppType {
  API
  WEB
  MOBILE
  WORKER
  CRON
}

enum DeploymentLogLevel {
  DEBUG
  INFO
  WARN
  ERROR
  CRITICAL
}

enum DeploymentPhase {
  INITIALIZATION
  FETCH_CODE
  BUILD
  TEST
  DEPLOY
  HEALTH_CHECK
  CLEANUP
  ROLLBACK
  COMPLETED
}

enum DeploymentTrigger {
  MANUAL
  AUTO
  PUSH
  PULL_REQUEST
  TAG
  SCHEDULE
  WEBHOOK
  ROLLBACK
  API
}

enum RegistrationStatus {
  ACTIVE
  SUSPENDED
  UNFIT
  ACTIVE_NOT_REGULAR
  DEREGISTERED
}

enum StreetType {
  STREET
  AVENUE
  ALLEY
  CROSSING
  SQUARE
  HIGHWAY
  ROAD
  WAY
  PLAZA
  LANE
  DEADEND
  SMALL_STREET
  PATH
  PASSAGE
  GARDEN
  BLOCK
  LOT
  SITE
  PARK
  FARM
  RANCH
  CONDOMINIUM
  COMPLEX
  RESIDENTIAL
  OTHER
}

// ============================================================================
// ANNOUNCEMENT/MESSAGE SYSTEM MODELS
// ============================================================================

model Message {
  id            String        @id @default(uuid())
  title         String
  content       Json // Rich content blocks (headings, paragraphs, images, buttons, etc.)
  status        MessageStatus @default(DRAFT)
  statusOrder   Int           @default(1)
  startDate     DateTime? // When message becomes active
  endDate       DateTime? // When message expires
  createdById   String
  metadata      Json? // Additional metadata (colors, icons, etc.)
  isDismissible Boolean       @default(true)
  requiresView  Boolean       @default(false) // Whether view tracking is required
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  publishedAt   DateTime? // When message was published
  archivedAt    DateTime? // When message was archived

  createdBy User            @relation("MESSAGE_CREATED_BY", fields: [createdById], references: [id])
  targets   MessageTarget[] @relation("MESSAGE_TARGETS")
  views     MessageView[]   @relation("MESSAGE_VIEWS")

  @@index([status, statusOrder])
  @@index([createdById])
  @@index([startDate])
  @@index([endDate])
  @@index([publishedAt])
  @@index([createdAt])
}

model MessageTarget {
  id        String   @id @default(uuid())
  messageId String
  userId    String // User who should see this message
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  message Message @relation("MESSAGE_TARGETS", fields: [messageId], references: [id], onDelete: Cascade)
  user    User    @relation("MESSAGE_TARGET_USER", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId]) // Prevent duplicate targets
  @@index([messageId])
  @@index([userId])
}

model MessageView {
  id          String    @id @default(uuid())
  messageId   String
  userId      String
  viewedAt    DateTime  @default(now()) // When message was first displayed
  dismissedAt DateTime? // When user clicked "don't show again" (null = not dismissed)
  deviceType  Platform? // Platform from where message was viewed
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  message Message @relation("MESSAGE_VIEWS", fields: [messageId], references: [id], onDelete: Cascade)
  user    User    @relation("MESSAGE_VIEW_USER", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, messageId])
  @@index([messageId])
  @@index([userId])
  @@index([viewedAt])
  @@index([dismissedAt])
}

// ============================================================================
// ENUMS FOR MESSAGE SYSTEM
// ============================================================================

enum MessageStatus {
  DRAFT // Message being created
  SCHEDULED // Message scheduled for future
  ACTIVE // Message currently active
  EXPIRED // Message past end date
  ARCHIVED // Message manually archived
}
